[{"id":"a5db2d6a.d5e07","type":"inject","z":"6a72c641.6eadf8","name":"Start ","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"x":106.26787567138672,"y":91.6737813949585,"wires":[["33f35963.2790c6"]]},{"id":"30cffe95.6e18c2","type":"debug","z":"6a72c641.6eadf8","name":"CONEXAO C/ SERVIDOR","active":false,"console":"false","complete":"payload","x":1268.0178871154785,"y":92.17377853393555,"wires":[]},{"id":"b1befc2c.960d1","type":"http in","z":"6a72c641.6eadf8","name":"maquinas listar","url":"/api/maquina/","method":"get","swaggerDoc":"","x":388.7319641113281,"y":1130.030912399292,"wires":[["b080bbfa.4b29b8"]]},{"id":"64b1e1b8.4818d","type":"http response","z":"6a72c641.6eadf8","name":"","x":858.7319278717041,"y":1130.0309114456177,"wires":[]},{"id":"b080bbfa.4b29b8","type":"function","z":"6a72c641.6eadf8","name":"Parametro Iniciais","func":"var myDate = new Date().toTimeString().replace(/.*(\\d{2}:\\d{2}:\\d{2}).*/, \"$1\");\n\nvar d = new Date();\nvar x = (\"00\" + (d.getMonth() + 1)).slice(-2) + \"/\" + \n        (\"00\" + d.getDate()).slice(-2) + \"/\" + \n        d.getFullYear() + \" \" + myDate;\n\nmsg.payload = \n[\n  {\n    \"_id\": \"Aplanadora-N3\",\n    \"codigo\": \"PERF-N3\",\n    \"nome\": \"Aplanadora N3\",\n    \"path\": \"maquinas/perfiladeiras/n3\",\n    \"rede\": [\n      { \"nome\": \"IHM\", \"ip\": \"192.168.2.230\", \"port\": 8080 },\n      { \"nome\": \"POP7\", \"ip\": \"192.168.2.231\" },\n      { \"nome\": \"ESP8266\", \"ip\": \"192.168.2.232\" }\n    ],\n    \"atualizacao\": d.toISOString(),\n    \"parametros\": {\n      \"encoder\": {\n        \"fator\": 9978,\n        \"resolucao\": 2500,\n        \"perimetro\": 400\n      },\n      \"manual\": {\n        \"aceleracao\": \"0.2\",\n        \"desaceleracao\": \"0.2\",\n        \"velocidade\": 30\n      },\n      \"automatico\": {\n        \"aceleracao\": \"0.2\",\n        \"desaceleracao\": \"0.2\",\n        \"velocidade\": 95,\n        \"paradaEntrePecasProduzidas\": 0,\n        \"tempoParada\": 0\n      },\n      \"transmissao\": {\n        \"reducao\": 0,\n        \"diametrorolo\": 0,\n        \"avancoMilimetrosPorRotacao\": 9.5144\n      },\n      \"corte\":{\n        \"espessura\": 0,\n        \"tempo\": 3\n      },\n      \"ferramenta\": {\n        \"passoN2\": 200,\n        \"passoN3\": 200,\n        \"passoN5\": 200\n      },\n      \"lubrificacao\": {\n        \"preset\": {\n          \"MbNovoCiclos\": 100000\n        },\n        \"ciclos\": {\n          \"PrsCiclos\": 5000\n        }\n      }\n    },\n    \"estado\": {\n      \"situacao\": {\n        \"codigo\": 4,\n        \"descricao\": \"Maquina OK\"\n      }\n    },\n    \"operadores\": [\n      { \"nome\": \"HELIO\", \"senha\": \"0aec9f876b8e62cba16c2704d99559d3\" },\n      { \"nome\": \"MARCELO\", \"senha\": \"99bb3473f26bb4814ea456d17af58f48\" }\n    ],\n    \"os\": [\n      {\n        \"numero\": \"10095646\",\n        \"produto\": {\n          \"codigo\": \"ESTCAN000N300000000#2000#0#0\",\n          \"descricao\": \"CANTONEIRA N-3 2000MM\",\n          \"quantidade\": 2,\n          \"produzido\": 0,\n          \"refugo\": 0\n        },\n        \"atualizacao\": \"2015-02-10T11:22:08.224Z\",\n        \"status\": \"produzindo\"\n      },\n      {\n        \"numero\": \"10095645\",\n        \"produto\": {\n          \"codigo\": \"ESTCAN000N300000000#2400#0#0\",\n          \"descricao\": \"CANTONEIRA N-3 2400MM\",\n          \"quantidade\": 2,\n          \"produzido\": 0,\n          \"refugo\": 0\n        },\n        \"atualizacao\": \"2015-02-10T11:22:08.224Z\",\n        \"status\": \"pendente\"\n      }\n    ]\n  },\n  {\n    \"_id\": \"Perfiladeira Reforco\",\n    \"codigo\": \"REFORCO\",\n    \"nome\": \"Perfiladeira Reforco\",\n    \"path\": \"maquinas/perfiladeiras/reforco\",\n    \"rede\": [\n      { \"nome\": \"IHM\", \"ip\": \"192.168.2.233\", \"port\": 8080 },\n      { \"nome\": \"POP7\", \"ip\": \"192.168.2.234\" },\n      { \"nome\": \"ESP8266\", \"ip\": \"192.168.2.235\" }\n    ],\n    \"atualizacao\": d.toISOString(),\n     \"parametros\": {\n      \"encoder\": {\n        \"fator\": 9986,\n        \"resolucao\": 2500,\n        \"perimetro\": 127.32\n      },\n      \"manual\": {\n        \"aceleracao\": \"0.2\",\n        \"desaceleracao\": \"0.2\",\n        \"velocidade\": 30\n      },\n      \"automatico\": {\n        \"aceleracao\": \"0.6\",\n        \"desaceleracao\": \"0.6\",\n        \"velocidade\": 95,\n        \"paradaEntrePecasProduzidas\": 20,\n        \"tempoParada\": 10\n      },\n      \"transmissao\": {\n        \"reducao\": 0,\n        \"diametrorolo\": 0,\n        \"avancoMilimetrosPorRotacao\": 9.5144\n      },\n      \"corte\":{\n        \"espessura\": 5,\n        \"tempo\": 3\n      },\n      \"ferramenta\": {\n        \"corte\": 1,\n        \"furo\": 20\n      },\n      \"lubrificacao\": {\n        \"preset\": {\n          \"MbNovoCiclos\": 100000\n        },\n        \"ciclos\": {\n          \"PrsCiclos\": 5000\n        }\n      }\n    },\n    \"estado\": {\n      \"situacao\": {\n        \"codigo\": 4,\n        \"descricao\": \"Maquina OK\"\n      }\n    },\n    \"operadores\": [\n      { \"nome\": \"HELIO\", \"senha\": \"0aec9f876b8e62cba16c2704d99559d3\" },\n      { \"nome\": \"MARCELO\", \"senha\": \"99bb3473f26bb4814ea456d17af58f48\" }\n    ],\n    \"os\": [\n      {\n        \"numero\": \"1231-11\",\n        \"produto\": {\n          \"codigo\": \"PPLESTREFOUGAL000000#0#0#610\",\n          \"descricao\": \"PERFIL U GALV P/ APOIO DE CAIXA MED 610MM\",\n          \"quantidade\": 2,\n          \"produzido\": 0,\n          \"refugo\": 0\n        },\n        \"atualizacao\": \"2015-02-11T11:22:08.224Z\",\n        \"status\": \"produzindo\"\n      },\n      {\n        \"numero\": \"8792-55\",\n        \"produto\": {\n          \"codigo\": \"PPLESTREFOUGAL000000#0#0#910\",\n          \"descricao\": \"PERFIL U GALV P/ APOIO DE CAIXA MED 910MM\",\n          \"quantidade\": 2,\n          \"produzido\": 0,\n          \"refugo\": 0\n        },\n        \"atualizacao\": \"2015-02-10T11:22:08.224Z\",\n        \"status\": \"pendente\"\n      }\n    ]\n  },\n    {\n    \"_id\": \"Perfiladeira Sigma 120\",\n    \"codigo\": \"Sigma 120\",\n    \"nome\": \"Perfiladeira Sigma 120\",\n    \"path\": \"maquinas/perfiladeiras/sigma120\",\n    \"rede\": [\n      { \"nome\": \"IHM\", \"ip\": \"192.168.2.236\", \"port\": 8080 },\n      { \"nome\": \"POP7\", \"ip\": \"192.168.2.237\" },\n      { \"nome\": \"ESP8266\", \"ip\": \"192.168.2.238\" }\n    ],\n    \"atualizacao\": d.toISOString(),\n     \"parametros\": {\n      \"encoder\": {\n        \"fator\": 9909,\n        \"resolucao\": 2500,\n        \"perimetro\": 400\n      },\n      \"manual\": {\n        \"aceleracao\": \"3\",\n        \"desaceleracao\": \"1\",\n        \"velocidade\": 30\n      },\n      \"automatico\": {\n        \"aceleracao\": \"2\",\n        \"desaceleracao\": \"1\",\n        \"velocidade\": 100,\n        \"paradaEntrePecasProduzidas\": 40,\n        \"tempoParada\": 2\n      },\n      \"transmissao\": {\n        \"reducao\": \"72.73\",\n        \"diametrorolo\": 165,\n        \"avancoMilimetrosPorRotacao\": 0\n      },\n      \"corte\":{\n        \"espessura\": 5,\n        \"tempo\": 3\n      },\n      \"ferramenta\": {\n        \"corte\": 1\n      },\n      \"lubrificacao\": {\n        \"preset\": {\n          \"MbNovoCiclos\": 100000\n        },\n        \"ciclos\": {\n          \"PrsCiclos\": 5000\n        }\n      }\n    },\n    \"estado\": {\n      \"situacao\": {\n        \"codigo\": 4,\n        \"descricao\": \"Maquina OK\"\n      }\n    },\n    \"operadores\": [\n      { \"nome\": \"HELIO\", \"senha\": \"0aec9f876b8e62cba16c2704d99559d3\" },\n      { \"nome\": \"MARCELO\", \"senha\": \"99bb3473f26bb4814ea456d17af58f48\" }\n    ],\n    \"os\": [\n      {\n        \"numero\": \"1231-11\",\n        \"produto\": {\n          \"codigo\": \"MEZSIG0CH1412000000#1800#0#0\",\n          \"descricao\": \"VIGA SIGMA 120 CH 2.00 MM MED 1800MM\",\n          \"quantidade\": 2,\n          \"produzido\": 0,\n          \"refugo\": 0\n        },\n        \"atualizacao\": \"2017-04-10T11:22:08.224Z\",\n        \"status\": \"Produzindo\"\n      },\n      {\n        \"numero\": \"8792-55\",\n        \"produto\": {\n          \"codigo\": \"PPLSTRSI120050D00000#1200#0#0\",\n          \"descricao\": \"STOP TRAZEIRO SIGMA 120 DEITADO MED 1200MM\",\n          \"quantidade\": 2,\n          \"produzido\": 0,\n          \"refugo\": 0\n        },\n        \"atualizacao\": \"2017-04-14T11:22:08.224Z\",\n        \"status\": \"Pendente\"\n      }\n    ]\n  }\n]\nnode.status({fill:\"blue\",shape:\"dot\",text:x});\nreturn msg;","outputs":1,"noerr":0,"x":627.7319869995117,"y":1131.0309209823608,"wires":[["64b1e1b8.4818d"]]},{"id":"7798c0de.996bd","type":"http in","z":"6a72c641.6eadf8","name":"maquinas alterar","url":"/api/maquina/","method":"put","swaggerDoc":"","x":389.73197174072266,"y":1227.0309228897095,"wires":[["c53caf82.7b835"]]},{"id":"a225083e.374278","type":"http response","z":"6a72c641.6eadf8","name":"","x":859.7319717407227,"y":1227.0309228897095,"wires":[]},{"id":"47270436.f6a71c","type":"function","z":"6a72c641.6eadf8","name":"SQL","func":"return msg;","outputs":1,"noerr":0,"x":639.7319717407227,"y":1227.0309228897095,"wires":[["a225083e.374278"]]},{"id":"a0dfdbfd.524628","type":"http in","z":"6a72c641.6eadf8","name":"maquinas incluir","url":"/api/maquina/","method":"post","swaggerDoc":"","x":389.73197174072266,"y":1178.0309228897095,"wires":[["c53caf82.7b835"]]},{"id":"28338255.b86aee","type":"http response","z":"6a72c641.6eadf8","name":"","x":859.7319717407227,"y":1178.0309228897095,"wires":[]},{"id":"6ec48c88.6fdb54","type":"function","z":"6a72c641.6eadf8","name":"SQL","func":"return msg;","outputs":1,"noerr":0,"x":639.7319717407227,"y":1178.0309228897095,"wires":[["28338255.b86aee"]]},{"id":"73afa062.9e82c","type":"function","z":"6a72c641.6eadf8","name":"Lista de maquinas","func":"msg.payload = \n{\n\"_id\": \"Maquinas\",\n    \"Aplanadora-N3\": {\n      \"IP-IHM\" : \"192.168.2.230\",\n      \"IP-POP7\": \"192.168.2.235\",\n      \"IP-ESP8266\" : \"\",\n      \"Atualizacao\" : \"2017-03-09T11:44:56.224Z\",\n      \"parametros\": {\n          \"encoder\": {\n              \"fator\": 9998,\n              \"resolucao\": 2500,\n              \"perimetro\": 400\n          },\n          \"velocidade\": {\n              \"automatico\": 100,\n              \"manual\": 30\n          },\n          \"ferramenta\": {\n              \"passo\": 200\n          },\n          \"lubrificacao\": {\n              \"preset\": {\n                  \"MbNovoCiclos\": 100000\n              },\n              \"ciclos\": {\n                  \"PrsCiclos\": 5000\n              }\n          }\n      },\n      \"estado\": {\n          \"situacao\": {\n              \"codigo\": 4,\n              \"descricao\": \"Maquina OK\"\n          }\n      },\n      \"operadores\": {\n          \"IRANILDO\": {\n            \"md5\": \"93d8659ef7a80a65d1434366d96c8e13\"\n          },\n          \"MARCELO\": {\n            \"md5\": \"995bf053c4694e1e353cfd42b94e4447\"\n          }\n      },\n      \"os\": {\n          \"1231-11\": {\n            \"produto\": {\n                \"codigo\": \"XXXXXXXXX\",\n                \"descricao\": \"AAAAAABBBBBCCCCC\",\n                \"quantidade\": 1550,\n                \"produzido\": 299,\n                \"refugo\": 2\n            },\n            \"status\": \"produzindo\"\n          },\n          \"8792-55\": {\n            \"produto\": {\n                \"codigo\": \"XXXXXXXXX\",\n                \"descricao\": \"AAAAAABBBBBCCCCC\",\n                \"quantidade\": 700,\n                \"produzido\": 10,\n                \"refugo\": 10\n            },\n            \"status\": \"pendente\"\n          }\n      }\n    },\n    \"Perfiladeira-Reforço\": {\n      \"IP-IHM\" : \"192.168.2.220\",\n      \"IP-POP7\": \"192.168.2.211\",\n      \"IP-ESP8266\" : \"\",\n      \"Atualizacao\" : \"2015-02-10T11:22:08.224Z\",\n      \"parametros\": {\n          \"encoder\": {\n              \"fator\": 9998,\n              \"resolucao\": 2500,\n              \"perimetro\": 400\n          },\n          \"velocidade\": {\n              \"automatico\": 100,\n              \"manual\": 30\n          },\n          \"ferramenta\": {\n              \"passo\": 200\n          },\n          \"lubrificacao\": {\n              \"preset\": {\n                  \"MbNovoCiclos\": 100000\n              },\n              \"ciclos\": {\n                  \"PrsCiclos\": 5000\n              }\n          }\n      },\n      \"estado\": {\n          \"situacao\": {\n              \"codigo\": 1,\n              \"descricao\": \"Desligada\"\n          }\n      },\n      \"operadores\": {\n          \"IRANILDO\": {\n            \"md5\": \"93d8659ef7a80a65d1434366d96c8e13\"\n          },\n          \"MARCELO\": {\n            \"md5\": \"995bf053c4694e1e353cfd42b94e4447\"\n          }\n      },\n      \"os\": {\n          \"9999-44\": {\n            \"produto\": {\n                \"codigo\": \"QQQQQQQQQQQQ\",\n                \"descricao\": \"KKKKKKKBBBBBCCCCC\",\n                \"quantidade\": 350,\n                \"produzido\": 350,\n                \"refugo\": 0\n            },\n            \"status\": \"finalizado\"\n          },\n          \"6662-00\": {\n            \"produto\": {\n                \"codigo\": \"YYYYYYY\",\n                \"descricao\": \"GGGGGGBBBBBCCCCC\",\n                \"quantidade\": 150,\n                \"produzido\": 155,\n                \"refugo\": 5\n            },\n            \"status\": \"finalizado\"\n          }\n      }\n    }\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":633.7319717407227,"y":1379.0309000015259,"wires":[["3eedb5b0.bf53aa"]]},{"id":"3eedb5b0.bf53aa","type":"debug","z":"6a72c641.6eadf8","name":"","active":true,"console":"false","complete":"false","x":875.2319717407227,"y":1379.0309228897095,"wires":[]},{"id":"567b08d6.ffac78","type":"inject","z":"6a72c641.6eadf8","name":"mostrar JSON","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":397.23197174072266,"y":1379.030930519104,"wires":[["73afa062.9e82c"]]},{"id":"50f4c46c.98a5ac","type":"http in","z":"6a72c641.6eadf8","name":"login","url":"/api/usuario/login","method":"post","swaggerDoc":"","x":360.1763572692871,"y":1468.0308990478516,"wires":[["fa358eaf.16afb","2fdc4210.7b9c4e"]]},{"id":"d9336347.051b8","type":"http response","z":"6a72c641.6eadf8","name":"","x":710.620922088623,"y":1462.0308990478516,"wires":[]},{"id":"64f451bd.9526d","type":"http in","z":"6a72c641.6eadf8","name":"/api/maquina/config/load","url":"/api/maquina/config","method":"get","swaggerDoc":"","x":424.87076568603516,"y":604.1975712776184,"wires":[["d6541a10.c44c48"]]},{"id":"d6541a10.c44c48","type":"function","z":"6a72c641.6eadf8","name":"Carrega parametros","func":"msg.payload = {\n    id: 123,\n    codigo: 'PERF-N3',\n    nome: 'Cantoneira N3',\n    path: 'maquinas/perfiladeiras/n3'\n};\n\nnode.status({fill:\"blue\",shape:\"dot\",text:msg.payload.codigo});\n// comentar essa linha\nmsg.payload = null;\n\nreturn msg;","outputs":1,"noerr":0,"x":734.8707733154297,"y":604.1975712776184,"wires":[["3806d066.f2091","dcffec7b.c644c"]]},{"id":"3806d066.f2091","type":"http response","z":"6a72c641.6eadf8","name":"","x":956.0929489135742,"y":604.1975827217102,"wires":[]},{"id":"fa358eaf.16afb","type":"debug","z":"6a72c641.6eadf8","name":"disparo ","active":true,"console":"false","complete":"payload","x":532.120922088623,"y":1514.0308990478516,"wires":[]},{"id":"91755e21.08bce","type":"debug","z":"6a72c641.6eadf8","name":"resposta SQL","active":true,"console":"false","complete":"payload","x":740.620922088623,"y":1510.0308990478516,"wires":[]},{"id":"2fdc4210.7b9c4e","type":"function","z":"6a72c641.6eadf8","name":"senha","func":"\nvar msg2 = {};\nmsg2.payload = msg.payload.senha;\n\nmsg.payload = {\n    id: 123,\n    usuario: 'rita',\n    senha: '2794d223f90059c9f705c73a99384085',\n    nome: 'rita'\n};\n\nreturn [msg,msg2];","outputs":"2","noerr":0,"x":521.620922088623,"y":1468.0308990478516,"wires":[["d9336347.051b8","91755e21.08bce"],[]]},{"id":"dcffec7b.c644c","type":"debug","z":"6a72c641.6eadf8","name":"resposta mongo config","active":true,"console":"false","complete":"payload","x":1003.870735168457,"y":565.5308976173401,"wires":[]},{"id":"ae335400.26cdf","type":"debug","z":"6a72c641.6eadf8","name":"IHM pedindo config","active":true,"console":"false","complete":"payload","x":778.7319641113281,"y":1632.0308561325073,"wires":[]},{"id":"af7967bb.d42b28","type":"comment","z":"6a72c641.6eadf8","name":"Node-red Local","info":"","x":382.6208953857422,"y":1428.0308923721313,"wires":[]},{"id":"c53caf82.7b835","type":"debug","z":"6a72c641.6eadf8","name":"","active":true,"console":"false","complete":"payload","x":668.7319564819336,"y":1279.030915260315,"wires":[]},{"id":"f0f8bc3c.149d7","type":"inject","z":"6a72c641.6eadf8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":393.73197174072266,"y":1083.0309228897095,"wires":[["b080bbfa.4b29b8"]]},{"id":"1d68c254.9b429e","type":"comment","z":"6a72c641.6eadf8","name":"INICIALIZANDO E CONECTANDO AO SERVIDOR - 192.168.0.1","info":"","x":262.5178756713867,"y":48.42377805709839,"wires":[]},{"id":"3d39405d.664c7","type":"comment","z":"6a72c641.6eadf8","name":"API DA IHM - 127.0.0.1/localhost","info":"","x":439.73197174072266,"y":1318.0309228897095,"wires":[]},{"id":"5bb0547d.1660bc","type":"http in","z":"6a72c641.6eadf8","name":"/api/maquina/config/save","url":"/api/maquina/config","method":"post","swaggerDoc":"","x":495.7319564819336,"y":1589.0308828353882,"wires":[["7c52d8c0.ca0ba8","ae335400.26cdf"]]},{"id":"7c52d8c0.ca0ba8","type":"http response","z":"6a72c641.6eadf8","name":"","x":893.7319717407227,"y":1590.0308618545532,"wires":[]},{"id":"5f497986.707428","type":"http response","z":"6a72c641.6eadf8","name":"","x":1028.2319634755454,"y":1803.285238371955,"wires":[]},{"id":"db901090.fb14b","type":"http in","z":"6a72c641.6eadf8","name":"Index","url":"/static/:file","method":"get","swaggerDoc":"","x":277.6763210296631,"y":1803.396300315857,"wires":[["56485a42.28ce74"]]},{"id":"56485a42.28ce74","type":"file in","z":"6a72c641.6eadf8","name":"index.HTML","filename":"/home/marcelomiranda/git/ihm/build/index.html","format":"utf8","x":665.7874368031821,"y":1803.5074130164253,"wires":[["7091b176.bc6ec","32efa350.784d7c"]]},{"id":"307db1ec.349b5e","type":"http response","z":"6a72c641.6eadf8","name":"","x":1028.676465352377,"y":1882.5232763290405,"wires":[]},{"id":"37ffcea4.895302","type":"function","z":"6a72c641.6eadf8","name":"Text/CSS","func":"msg.headers = { \"Content-type\" : \"text/css\" }\n \nreturn msg;","outputs":1,"noerr":0,"x":867.231876373291,"y":1882.4121294021606,"wires":[["307db1ec.349b5e"]]},{"id":"b8327169.6d72d","type":"comment","z":"6a72c641.6eadf8","name":"HTML","info":"","x":277.23194821675634,"y":1767.2852135764228,"wires":[]},{"id":"a1b6b855.e93178","type":"comment","z":"6a72c641.6eadf8","name":"CSS folder","info":"","x":288.12077713012695,"y":1845.9678621292114,"wires":[]},{"id":"7def20e5.501a5","type":"comment","z":"6a72c641.6eadf8","name":"JAVASCRIPT folder","info":"","x":317.5652770996094,"y":1925.4123764038086,"wires":[]},{"id":"3d83bb34.151e74","type":"http response","z":"6a72c641.6eadf8","name":"","x":1028.6764272054043,"y":1962.9676961898804,"wires":[]},{"id":"d31accd4.c95e9","type":"http in","z":"6a72c641.6eadf8","name":"Scripts","url":"/static/js/:file","method":"get","swaggerDoc":"","x":278.1207847595215,"y":1963.0787581337822,"wires":[["21773191.fa15ce"]]},{"id":"8dd563f2.20762","type":"comment","z":"6a72c641.6eadf8","name":"media folder","info":"","x":297.34295654296875,"y":2012.0787744522095,"wires":[]},{"id":"319672cd.1000fe","type":"http response","z":"6a72c641.6eadf8","name":"","x":1027.8986562093105,"y":2047.412299156189,"wires":[]},{"id":"5b2ac543.ede2bc","type":"http in","z":"6a72c641.6eadf8","name":"media","url":"/static/media/:file","method":"get","swaggerDoc":"","x":277.34301376342773,"y":2047.5233611000908,"wires":[["d840ad2b.a3812"]]},{"id":"7ef106ad.51c5f8","type":"function","z":"6a72c641.6eadf8","name":"media","func":"var ext = msg.filename.split('.')[msg.filename.split('.').length - 1]\n\nconsole.log('File extension: ' + ext)\n\nswitch(ext) {\n    case 'eot':\n        msg.headers = { \"Content-type\" : \"application/vnd.ms-fontobject\" }\n        break;\n    case 'svg':\n        msg.headers = { \"Content-type\" : \"image/svg+xml\" }\n        break;\n    case 'png':\n        msg.headers = { \"Content-type\" : \"image/png\" }\n        break;\n    case 'gif':\n        msg.headers = { \"Content-type\" : \"image/gif\" }\n        break;\n    case 'ico':\n        msg.headers = { \"Content-type\" : \"image/x-icon\" }\n        break;\n    case ('jpeg'||'jpg'):\n        msg.headers = { \"Content-type\" : \"image/jpeg\" }\n        break;\n    case 'ttf':\n        msg.headers = { \"Content-type\" : \"application/x-font-ttf\" }\n        break;\n    case 'woff':\n        msg.headers = { \"Content-type\" : \"application/font-woff\" }\n        break;\n    case 'woff2':\n        msg.headers = { \"Content-type\" : \"application/font-woff2\" }\n        break;\n    case 'otf':\n        msg.headers = { \"Content-type\" : \"application/x-font-opentype\" }\n        break;\n    case 'ttf':\n        msg.headers = { \"Content-type\" : \"application/font-sfnt\" }\n        break;\n}\n\n\nreturn msg;","outputs":1,"noerr":0,"x":859.1208076477051,"y":2047.3011865615845,"wires":[["319672cd.1000fe","c2545571.490428"]]},{"id":"7091b176.bc6ec","type":"function","z":"6a72c641.6eadf8","name":"Text/HTML","func":"msg.headers = { \"Content-type\" : \"text/html\" }\n\nreturn msg;","outputs":1,"noerr":0,"x":876.0652154286704,"y":1803.3063870535957,"wires":[["5f497986.707428"]]},{"id":"4a1b8d98.48b354","type":"http in","z":"6a72c641.6eadf8","name":"CSS Files","url":"/static/css/:file","method":"get","swaggerDoc":"","x":289.0282783508301,"y":1882.1419066323174,"wires":[["f173079.6f472f8"]]},{"id":"f173079.6f472f8","type":"function","z":"6a72c641.6eadf8","name":"files","func":"msg.filename = '//home//marcelomiranda//git//sitio//build//static//css//' + msg.req.params.file;\nreturn msg;","outputs":1,"noerr":0,"x":521.2505226135254,"y":1881.9197386635674,"wires":[["24b924bc.53751c"]]},{"id":"24b924bc.53751c","type":"file in","z":"6a72c641.6eadf8","name":"","filename":"","format":"","x":687.4727592468262,"y":1882.0309065712822,"wires":[["37ffcea4.895302","aa340056.831ef"]]},{"id":"21773191.fa15ce","type":"function","z":"6a72c641.6eadf8","name":"files","func":"msg.filename = '//home//marcelomiranda//git//sitio//build//static//js//' + msg.req.params.file;\nreturn msg;","outputs":1,"noerr":0,"x":519.0002861022949,"y":1963.9752185344696,"wires":[["485f092f.21aa38"]]},{"id":"d840ad2b.a3812","type":"function","z":"6a72c641.6eadf8","name":"files","func":"msg.filename = '//home//marcelomiranda//git//sitio//build//static//media//' + msg.req.params.file;\nreturn msg;","outputs":1,"noerr":0,"x":524.5838279724121,"y":2047.2529791726006,"wires":[["f12987a5.98f148"]]},{"id":"485f092f.21aa38","type":"file in","z":"6a72c641.6eadf8","name":"","filename":"","format":"","x":687.9172096252441,"y":1963.9197386635674,"wires":[["f0ce9cf8.f1888","3d83bb34.151e74"]]},{"id":"f0ce9cf8.f1888","type":"debug","z":"6a72c641.6eadf8","name":"FIles JS","active":true,"console":"false","complete":"filename","x":867.8061141967773,"y":2002.6975687874688,"wires":[]},{"id":"f12987a5.98f148","type":"file in","z":"6a72c641.6eadf8","name":"","filename":"","format":"","x":690.1393775939941,"y":2047.03070057763,"wires":[["7ef106ad.51c5f8"]]},{"id":"aa340056.831ef","type":"debug","z":"6a72c641.6eadf8","name":"CSS files","active":true,"console":"false","complete":"true","x":868.1394386291504,"y":1927.2529906166924,"wires":[]},{"id":"36e75ad2.ca4f76","type":"comment","z":"6a72c641.6eadf8","name":"Servidor WEB","info":"$options => i for case insensitive search\n\nStart with string\n\ndb.collection.find({zip:{'$regex' : '^string', '$options' : 'i'}})\nEnd with string\n\ndb.collection.find({zip:{'$regex' : 'string$', '$options' : 'i'}})\nContains string\n\ndb.collection.find({zip:{'$regex' : 'string', '$options' : 'i'}})\nDoesn't Contains string\n\ndb.collection.find({zip:{'$regex' : '^((?!string).)*$', '$options' : 'i'}})\nKeep this as a bookmark, and a reference for any other alterations you may need. http://www.cheatography.com/davechild/cheat-sheets/regular-expressions/","x":705.6949075063071,"y":1750.7370177374946,"wires":[]},{"id":"32efa350.784d7c","type":"debug","z":"6a72c641.6eadf8","name":"saida","active":true,"console":"false","complete":"true","x":856.9819405873618,"y":1763.418668852912,"wires":[]},{"id":"c2545571.490428","type":"debug","z":"6a72c641.6eadf8","name":"Fonts Files","active":true,"console":"false","complete":"headers","x":1049.48189163208,"y":2097.538472175598,"wires":[]},{"id":"6dfa8f54.2ccb8","type":"mongodb out","z":"6a72c641.6eadf8","mongodb":"99b811f7.2a08b","name":"APAGAR TODA A COLLECTION log_erro","collection":"log_erro","payonly":true,"upsert":false,"multi":false,"operation":"delete","x":834.7320327758789,"y":759.114221572876,"wires":[]},{"id":"f20c811e.9f07","type":"inject","z":"6a72c641.6eadf8","name":"LIMPAR coleção log_erro","topic":"","payload":"{}","payloadType":"json","repeat":"","crontab":"","once":false,"x":459.48558044433594,"y":759.8412771224976,"wires":[["6dfa8f54.2ccb8"]]},{"id":"65107c43.480f34","type":"comment","z":"6a72c641.6eadf8","name":"Apagar Cuidado","info":"#Resultados de paginação usando skip e limit\n\nMuitas vezes, ao lidar com conjuntos de resultados de dados, \nsó queremos recuperar um subconjunto por vez, talvez para fornecer \nresultados por página da Web. Em MySQL, em geral fazemos isso \nusando a palavra-chave LIMIT. \nÉ fácil replicar essa funcionalidade no MongoDB \nusando msg.skip e msg.limit. \nPara retornar os primeiros cinco documentos na \ncoleção, podemos executar a seguinte operação:\n> msg.limit = 5;<\n\nPara pular resultados, use o seguinte comando:\n\n> msg.skip = 5;<\n\nCom ele é possível iguinorar os primeiros cinco\nregistros. ","x":406.0651168823242,"y":670.8920183181763,"wires":[]},{"id":"6685280e.dd7a38","type":"mongodb out","z":"6a72c641.6eadf8","mongodb":"99b811f7.2a08b","name":"APAGAR TODA A COLLECTION config","collection":"config","payonly":true,"upsert":false,"multi":false,"operation":"delete","x":833.1762771606445,"y":711.8919925689697,"wires":[]},{"id":"ca24648d.5f40e8","type":"inject","z":"6a72c641.6eadf8","name":"LIMPAR coleção config","topic":"","payload":"{}","payloadType":"json","repeat":"","crontab":"","once":false,"x":449.8184280395508,"y":711.8411960601807,"wires":[["6685280e.dd7a38"]]},{"id":"5de2fa1b.524854","type":"inject","z":"6a72c641.6eadf8","name":"LIMPAR coleção indice","topic":"","payload":"{}","payloadType":"json","repeat":"","crontab":"","once":false,"x":449.58374786376953,"y":805.7811107635498,"wires":[["1076170a.89ac79"]]},{"id":"1076170a.89ac79","type":"mongodb out","z":"6a72c641.6eadf8","mongodb":"99b811f7.2a08b","name":"APAGAR TODA A COLLECTION indice","collection":"indice","payonly":true,"upsert":false,"multi":false,"operation":"delete","x":835.5837478637695,"y":805.4477367401123,"wires":[]},{"id":"fa042579.7699d8","type":"inject","z":"6a72c641.6eadf8","name":"String vazia","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"x":417.7319641113281,"y":988.3642387390137,"wires":[["787ef79c.1d9aa8"]]},{"id":"421cbd40.7bf854","type":"mongodb in","z":"6a72c641.6eadf8","mongodb":"99b811f7.2a08b","name":"consulta","collection":"parametros","operation":"find","x":936.6991348266602,"y":988.7197351455688,"wires":[["e87e66c4.e004b8"]]},{"id":"e87e66c4.e004b8","type":"debug","z":"6a72c641.6eadf8","name":"resposta do MongoDB","active":true,"console":"false","complete":"payload","x":1220.8101768493652,"y":988.8308906555176,"wires":[]},{"id":"187a924d.2798ce","type":"function","z":"6a72c641.6eadf8","name":"contador +1","func":"msg.query = { _id: 'AplanadoraN3' }\nmsg.payload = {\n    $inc: {\n       \"os.produzido\": 1\n     }\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":738.9212341308594,"y":895.2975578308105,"wires":[["cb536c09.ec16b"]]},{"id":"cb536c09.ec16b","type":"mongodb out","z":"6a72c641.6eadf8","mongodb":"99b811f7.2a08b","name":"salvar","collection":"parametros","payonly":true,"upsert":false,"multi":false,"operation":"update","x":946.9212188720703,"y":895.6975517272949,"wires":[]},{"id":"ede9c485.d323f8","type":"inject","z":"6a72c641.6eadf8","name":"$inc: incrementa","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"x":425.7547721862793,"y":894.9642543792725,"wires":[["187a924d.2798ce","eb685cce.a5859"]]},{"id":"787ef79c.1d9aa8","type":"function","z":"6a72c641.6eadf8","name":"Paginação ","func":"msg.limit = 5;\nmsg.skip = 0;\nreturn msg;","outputs":1,"noerr":0,"x":735.1434879302979,"y":988.7790184020996,"wires":[["421cbd40.7bf854"]]},{"id":"4e16d28d.2072bc","type":"comment","z":"6a72c641.6eadf8","name":"Paginação  e consulta MongoDB","info":"#Resultados de paginação usando skip e limit\n\nMuitas vezes, ao lidar com conjuntos de resultados de dados, \nsó queremos recuperar um subconjunto por vez, talvez para fornecer \nresultados por página da Web. Em MySQL, em geral fazemos isso \nusando a palavra-chave LIMIT. \nÉ fácil replicar essa funcionalidade no MongoDB \nusando msg.skip e msg.limit. \nPara retornar os primeiros cinco documentos na \ncoleção, podemos executar a seguinte operação:\n> msg.limit = 5;<\n\nPara pular resultados, use o seguinte comando:\n\n> msg.skip = 5;<\n\nCom ele é possível iguinorar os primeiros cinco\nregistros. ","x":453.9213218688965,"y":952.6308579444885,"wires":[]},{"id":"eb685cce.a5859","type":"function","z":"6a72c641.6eadf8","name":"Delay 50ms","func":"setTimeout(function() {\n    node.send(msg);\n}, 50);\nreturn null;","outputs":1,"noerr":0,"x":738.254638671875,"y":930.7418451309204,"wires":[["787ef79c.1d9aa8"]]},{"id":"a69c1614.8d8d88","type":"comment","z":"6a72c641.6eadf8","name":"Contador Produzidos ++ ","info":"#Resultados de paginação usando skip e limit\n\nMuitas vezes, ao lidar com conjuntos de resultados de dados, \nsó queremos recuperar um subconjunto por vez, talvez para fornecer \nresultados por página da Web. Em MySQL, em geral fazemos isso \nusando a palavra-chave LIMIT. \nÉ fácil replicar essa funcionalidade no MongoDB \nusando msg.skip e msg.limit. \nPara retornar os primeiros cinco documentos na \ncoleção, podemos executar a seguinte operação:\n> msg.limit = 5;<\n\nPara pular resultados, use o seguinte comando:\n\n> msg.skip = 5;<\n\nCom ele é possível iguinorar os primeiros cinco\nregistros. ","x":430.92081451416016,"y":859.6308145523071,"wires":[]},{"id":"d924c639.596bf8","type":"mongodb in","z":"6a72c641.6eadf8","mongodb":"ea40591b.5f6778","name":"consulta","collection":"config","operation":"find","x":874.8621063232422,"y":142.3247413635254,"wires":[["9fa842b1.db9e1"]]},{"id":"9fa842b1.db9e1","type":"function","z":"6a72c641.6eadf8","name":"Dados OK","func":"var msg2 = {};\n\n//node.error(\"Error\",msg)\nif (msg.payload.length){\n    msg.payload=msg.payload[0]._id;\n    msg2 = null;\n    node.status({fill:\"blue\",shape:\"dot\",text:msg.payload});\n    \n}else{\n    msg2.payload=\"erro\";\n    msg = null;\n    node.status({fill:\"red\",shape:\"dot\",text:'erro'});\n}\n\nreturn [msg,msg2];\n","outputs":"2","noerr":0,"x":1024.8067588806152,"y":142.74144577980042,"wires":[["f424d623.ca5768"],["b75a84cf.1fa278","498b224.78640dc","5b3053c5.e49f0c","4deeb71c.ace508"]]},{"id":"f424d623.ca5768","type":"debug","z":"6a72c641.6eadf8","name":"ok","active":true,"console":"false","complete":"payload","x":1209.8067474365234,"y":136.24133396148682,"wires":[]},{"id":"f6893a36.013418","type":"function","z":"6a72c641.6eadf8","name":"BANCO LOCAL?","func":"// No parametro projection 1 ou zero significa ler ou inguinorar resultado\nmsg.projection = { _id: 1 }\nmsg.limit = 50;\nmsg.skip = 0;\nreturn msg;","outputs":1,"noerr":0,"x":697.000373840332,"y":142.1483154296875,"wires":[["d924c639.596bf8"]]},{"id":"33f35963.2790c6","type":"function","z":"6a72c641.6eadf8","name":"Variaveis Globais","func":"var mssql = global.get('mssql');\n\nvar PRODUCAO = new mssql.Connection(\"mssql://financeiro:financeiro@192.168.0.1/FINANCEIRO\", function(err) {\n    if (err) {\n        global.set('conectadoServidor', 0);\n        PRODUCAO.on('error', function(err) {\n            node.error({payload: err || { erro: 9996, mensagem: 'Erro desconhecido na conexão'}});\n        });\n    } else {\n        global.set('conectadoServidor', 1);\n    }\n});\n\n//Estado inicial da maquina é não inicializada MaqInicializada=0\nglobal.set('conectadoServidor', 0);\nglobal.set(\"ComandoMaquina\",0);//liberamensagens do bloco libera maquina\nglobal.set(\"MotorPrensa\",0);\nglobal.set(\"MotorLigado\",0);\nglobal.set(\"MotorInvertido\",0);\nglobal.set(\"Desbobinador\",0);\nglobal.set(\"Indice_Mongo\",0);\nglobal.set(\"TamanhoDesejadoPeca_KEYBOARD\",0);\nglobal.set(\"TamanhoRealPeca_KEYBOARD\",0);\nglobal.set(\"FatorEncoder\",9909);\nglobal.set(\"ModBus\",[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);\nvar start = new Date().getTime();\nglobal.set(\"tempo\",start);\n\nvar mensagens = [];\n\nmensagens['LER_CLP_MODBUS'] =        { type: 'error', message: ' CLP não responde. Verifique as conexões de rede.' };\nmensagens['EMERGENCIA'] =            { type: 'error', message: ' Emergencia acionada!' };\nmensagens['FALTA_FASE'] =            { type: 'error', message: ' Falta de Fase' };\nmensagens['BOMBA_HIDRAULICA'] =      { type: 'error', message: ' Térmico da Bomba Hidraulica' };\nmensagens['MARTELO_PRENSA'] =        { type: 'error', message: ' Térmico do Motor do Martelo Prensa' };\nmensagens['PRESSAO_AR'] =            { type: 'warning', message: 'Pressao do Ar Baixa!' };\nmensagens['INVERSOR'] =              { type: 'error', message: ' Erro no Inversor' };\nmensagens['SERVO'] =                 { type: 'error', message: ' Erro no Servo' };\nmensagens['CHAVE_GERAL_DESLIGADA'] = { type: 'warning', message: ' Chave Geral Desligada' };\nmensagens['CHAVE_GERAL_LIGADA']    = { type: 'warning', message: ' Chave Geral ligada' };\nmensagens['MAQUINA_NAO_LIBERADA'] =  { type: 'warning', message: ' Maquina Não Liberada' };\nmensagens['MAQUINA_LIBERADA']     =  { type: 'warning', message: ' Maquina Liberada' };\nmensagens['ERRO_POSICIONAMENTO']=    { type: 'error', message: ' Erro Posicionamento' };\nmensagens['SEGURAN_PRENSA'] =        { type: 'info', message: ' Segurança da Prensa' };\nmensagens['APLAN_ABERTA'] =          { type: 'info', message: ' Aplanadora Aberda' };\n\nglobal.set(\"mensagens\",mensagens);\nmsg= {payload: \"{MAQUINA_OFF:0}\"};\nreturn msg;","outputs":1,"noerr":0,"x":267.7463073730469,"y":91.36992168426514,"wires":[["667ba04f.66114"]]},{"id":"667ba04f.66114","type":"function","z":"6a72c641.6eadf8","name":"Delay 100ms","func":"setTimeout(function() {\n    node.send(msg);\n}, 100);\nreturn null;","outputs":1,"noerr":0,"x":453.7462272644043,"y":91.36992263793945,"wires":[["726a473.44b8ab8","f6893a36.013418"]]},{"id":"726a473.44b8ab8","type":"function","z":"6a72c641.6eadf8","name":"SERVIDOR OK?","func":"if(global.get('conectadoServidor')){\n    console.dir('CONECTADO AO SERVIDOR !');\n    node.status({fill:\"blue\",shape:\"dot\",text:'CONECTADO COM SERVIDOR'});\n}else{\n    console.dir('-------------> ERRO NA CONEXAO PRODUCAO !!!!!! <-------------');\n    node.status({fill:\"red\",shape:\"dot\",text:'ERRO'});\n}\n\nmsg= {payload: global.get('conectadoServidor')};\nreturn msg;\n","outputs":1,"noerr":0,"x":687.7463073730469,"y":92.36992359161377,"wires":[["30cffe95.6e18c2"]]},{"id":"b75a84cf.1fa278","type":"debug","z":"6a72c641.6eadf8","name":"erro","active":true,"console":"false","complete":"payload","x":1208.7678146362305,"y":176.9237813949585,"wires":[]},{"id":"498b224.78640dc","type":"function","z":"6a72c641.6eadf8","name":"Parametro Iniciais","func":"var myDate = new Date().toTimeString().replace(/.*(\\d{2}:\\d{2}:\\d{2}).*/, \"$1\");\n\nvar d = new Date();\nvar x = (\"00\" + (d.getMonth() + 1)).slice(-2) + \"/\" + \n        (\"00\" + d.getDate()).slice(-2) + \"/\" + \n        d.getFullYear() + \" \" + myDate;\n\nmsg.payload = \n[\n  {\n    \"_id\": \"Aplanadora-N3\",\n    \"codigo\": \"PERF-N3\",\n    \"nome\": \"Aplanadora N3\",\n    \"path\": \"maquinas/perfiladeiras/n3\",\n    \"rede\": [\n      { \"nome\": \"IHM\", \"ip\": \"192.168.2.230\", \"port\": 8080 },\n      { \"nome\": \"POP7\", \"ip\": \"192.168.2.231\" },\n      { \"nome\": \"ESP8266\", \"ip\": \"192.168.2.232\" }\n    ],\n    \"atualizacao\": d.toISOString(),\n    \"parametros\": {\n      \"encoder\": {\n        \"fator\": 9978,\n        \"resolucao\": 2500,\n        \"perimetro\": 400\n      },\n      \"manual\": {\n        \"aceleracao\": \"0.2\",\n        \"desaceleracao\": \"0.2\",\n        \"velocidade\": 30\n      },\n      \"automatico\": {\n        \"aceleracao\": \"0.2\",\n        \"desaceleracao\": \"0.2\",\n        \"velocidade\": 95,\n        \"paradaEntrePecasProduzidas\": 0,\n        \"tempoParada\": 0\n      },\n      \"transmissao\": {\n        \"reducao\": 0,\n        \"diametrorolo\": 0,\n        \"avancoMilimetrosPorRotacao\": 9.5144\n      },\n      \"corte\":{\n        \"espessura\": 0,\n        \"tempo\": 3\n      },\n      \"ferramenta\": {\n        \"passoN2\": 200,\n        \"passoN3\": 200,\n        \"passoN5\": 200\n      },\n      \"lubrificacao\": {\n        \"preset\": {\n          \"MbNovoCiclos\": 100000\n        },\n        \"ciclos\": {\n          \"PrsCiclos\": 5000\n        }\n      }\n    },\n    \"estado\": {\n      \"situacao\": {\n        \"codigo\": 4,\n        \"descricao\": \"Maquina OK\"\n      }\n    },\n    \"operadores\": [\n      { \"nome\": \"HELIO\", \"senha\": \"0aec9f876b8e62cba16c2704d99559d3\" },\n      { \"nome\": \"MARCELO\", \"senha\": \"99bb3473f26bb4814ea456d17af58f48\" }\n    ],\n    \"os\": [\n      {\n        \"numero\": \"10095646\",\n        \"produto\": {\n          \"codigo\": \"ESTCAN000N300000000#2000#0#0\",\n          \"descricao\": \"CANTONEIRA N-3 2000MM\",\n          \"quantidade\": 2,\n          \"produzido\": 0,\n          \"refugo\": 0\n        },\n        \"atualizacao\": \"2015-02-10T11:22:08.224Z\",\n        \"status\": \"produzindo\"\n      },\n      {\n        \"numero\": \"10095645\",\n        \"produto\": {\n          \"codigo\": \"ESTCAN000N300000000#2400#0#0\",\n          \"descricao\": \"CANTONEIRA N-3 2400MM\",\n          \"quantidade\": 2,\n          \"produzido\": 0,\n          \"refugo\": 0\n        },\n        \"atualizacao\": \"2015-02-10T11:22:08.224Z\",\n        \"status\": \"pendente\"\n      }\n    ]\n  },\n  {\n    \"_id\": \"Perfiladeira Reforco\",\n    \"codigo\": \"REFORCO\",\n    \"nome\": \"Perfiladeira Reforco\",\n    \"path\": \"maquinas/perfiladeiras/reforco\",\n    \"rede\": [\n      { \"nome\": \"IHM\", \"ip\": \"192.168.2.233\", \"port\": 8080 },\n      { \"nome\": \"POP7\", \"ip\": \"192.168.2.234\" },\n      { \"nome\": \"ESP8266\", \"ip\": \"192.168.2.235\" }\n    ],\n    \"atualizacao\": d.toISOString(),\n     \"parametros\": {\n      \"encoder\": {\n        \"fator\": 9986,\n        \"resolucao\": 2500,\n        \"perimetro\": 127.32\n      },\n      \"manual\": {\n        \"aceleracao\": \"0.2\",\n        \"desaceleracao\": \"0.2\",\n        \"velocidade\": 30\n      },\n      \"automatico\": {\n        \"aceleracao\": \"0.6\",\n        \"desaceleracao\": \"0.6\",\n        \"velocidade\": 95,\n        \"paradaEntrePecasProduzidas\": 20,\n        \"tempoParada\": 10\n      },\n      \"transmissao\": {\n        \"reducao\": 0,\n        \"diametrorolo\": 0,\n        \"avancoMilimetrosPorRotacao\": 9.5144\n      },\n      \"corte\":{\n        \"espessura\": 5,\n        \"tempo\": 3\n      },\n      \"ferramenta\": {\n        \"corte\": 1,\n        \"furo\": 20\n      },\n      \"lubrificacao\": {\n        \"preset\": {\n          \"MbNovoCiclos\": 100000\n        },\n        \"ciclos\": {\n          \"PrsCiclos\": 5000\n        }\n      }\n    },\n    \"estado\": {\n      \"situacao\": {\n        \"codigo\": 4,\n        \"descricao\": \"Maquina OK\"\n      }\n    },\n    \"operadores\": [\n      { \"nome\": \"HELIO\", \"senha\": \"0aec9f876b8e62cba16c2704d99559d3\" },\n      { \"nome\": \"MARCELO\", \"senha\": \"99bb3473f26bb4814ea456d17af58f48\" }\n    ],\n    \"os\": [\n      {\n        \"numero\": \"1231-11\",\n        \"produto\": {\n          \"codigo\": \"PPLESTREFOUGAL000000#0#0#610\",\n          \"descricao\": \"PERFIL U GALV P/ APOIO DE CAIXA MED 610MM\",\n          \"quantidade\": 2,\n          \"produzido\": 0,\n          \"refugo\": 0\n        },\n        \"atualizacao\": \"2015-02-11T11:22:08.224Z\",\n        \"status\": \"produzindo\"\n      },\n      {\n        \"numero\": \"8792-55\",\n        \"produto\": {\n          \"codigo\": \"PPLESTREFOUGAL000000#0#0#910\",\n          \"descricao\": \"PERFIL U GALV P/ APOIO DE CAIXA MED 910MM\",\n          \"quantidade\": 2,\n          \"produzido\": 0,\n          \"refugo\": 0\n        },\n        \"atualizacao\": \"2015-02-10T11:22:08.224Z\",\n        \"status\": \"pendente\"\n      }\n    ]\n  },\n    {\n    \"_id\": \"Perfiladeira Sigma 120\",\n    \"codigo\": \"Sigma 120\",\n    \"nome\": \"Perfiladeira Sigma 120\",\n    \"path\": \"maquinas/perfiladeiras/sigma120\",\n    \"rede\": [\n      { \"nome\": \"IHM\", \"ip\": \"192.168.2.236\", \"port\": 8080 },\n      { \"nome\": \"POP7\", \"ip\": \"192.168.2.237\" },\n      { \"nome\": \"ESP8266\", \"ip\": \"192.168.2.238\" }\n    ],\n    \"atualizacao\": d.toISOString(),\n     \"parametros\": {\n      \"encoder\": {\n        \"fator\": 9909,\n        \"resolucao\": 2500,\n        \"perimetro\": 400\n      },\n      \"manual\": {\n        \"aceleracao\": \"3\",\n        \"desaceleracao\": \"1\",\n        \"velocidade\": 30\n      },\n      \"automatico\": {\n        \"aceleracao\": \"2\",\n        \"desaceleracao\": \"1\",\n        \"velocidade\": 100,\n        \"paradaEntrePecasProduzidas\": 40,\n        \"tempoParada\": 2\n      },\n      \"transmissao\": {\n        \"reducao\": \"72.73\",\n        \"diametrorolo\": 165,\n        \"avancoMilimetrosPorRotacao\": 0\n      },\n      \"corte\":{\n        \"espessura\": 5,\n        \"tempo\": 3\n      },\n      \"ferramenta\": {\n        \"corte\": 1\n      },\n      \"lubrificacao\": {\n        \"preset\": {\n          \"MbNovoCiclos\": 100000\n        },\n        \"ciclos\": {\n          \"PrsCiclos\": 5000\n        }\n      }\n    },\n    \"estado\": {\n      \"situacao\": {\n        \"codigo\": 4,\n        \"descricao\": \"Maquina OK\"\n      }\n    },\n    \"operadores\": [\n      { \"nome\": \"HELIO\", \"senha\": \"0aec9f876b8e62cba16c2704d99559d3\" },\n      { \"nome\": \"MARCELO\", \"senha\": \"99bb3473f26bb4814ea456d17af58f48\" }\n    ],\n    \"os\": [\n      {\n        \"numero\": \"1231-11\",\n        \"produto\": {\n          \"codigo\": \"MEZSIG0CH1412000000#1800#0#0\",\n          \"descricao\": \"VIGA SIGMA 120 CH 2.00 MM MED 1800MM\",\n          \"quantidade\": 2,\n          \"produzido\": 0,\n          \"refugo\": 0\n        },\n        \"atualizacao\": \"2017-04-10T11:22:08.224Z\",\n        \"status\": \"Produzindo\"\n      },\n      {\n        \"numero\": \"8792-55\",\n        \"produto\": {\n          \"codigo\": \"PPLSTRSI120050D00000#1200#0#0\",\n          \"descricao\": \"STOP TRAZEIRO SIGMA 120 DEITADO MED 1200MM\",\n          \"quantidade\": 2,\n          \"produzido\": 0,\n          \"refugo\": 0\n        },\n        \"atualizacao\": \"2017-04-14T11:22:08.224Z\",\n        \"status\": \"Pendente\"\n      }\n    ]\n  }\n]\nnode.status({fill:\"blue\",shape:\"dot\",text:x});\nreturn msg;","outputs":1,"noerr":0,"x":1248.086051940918,"y":217.9237813949585,"wires":[["41407f8.493688"]]},{"id":"41407f8.493688","type":"split","z":"6a72c641.6eadf8","name":"","splt":"\\n","x":1419.7301902770996,"y":218.3229112625122,"wires":[["f2d5ae18.53d88"]]},{"id":"f2d5ae18.53d88","type":"mongodb out","z":"6a72c641.6eadf8","mongodb":"99b811f7.2a08b","name":"salvar config","collection":"config","payonly":true,"upsert":false,"multi":false,"operation":"store","x":1573.4088287353516,"y":218.0326681137085,"wires":[]},{"id":"48532d7c.9f5a84","type":"mongodb out","z":"6a72c641.6eadf8","mongodb":"99b811f7.2a08b","name":"salvar","collection":"log_erro","payonly":true,"upsert":false,"multi":false,"operation":"store","x":1593.6997375488281,"y":266.67379570007324,"wires":[]},{"id":"5b3053c5.e49f0c","type":"function","z":"6a72c641.6eadf8","name":"collection inicial log_erro","func":"var myDate = new Date().toTimeString().replace(/.*(\\d{2}:\\d{2}:\\d{2}).*/, \"$1\");\nvar d = new Date();\nvar x = (\"00\" + (d.getMonth() + 1)).slice(-2) + \"/\" + \n        (\"00\" + d.getDate()).slice(-2) + \"/\" + \n        d.getFullYear() + \" \" + myDate;\n        \nmsg.payload = {\n\t\"_id\": 1,\n\t\"log_mesagens\": {\n\t}\n}\nnode.status({fill:\"blue\",shape:\"dot\",text:x});\nreturn msg;","outputs":1,"noerr":0,"x":1268.4586868286133,"y":266.77856826782227,"wires":[["48532d7c.9f5a84"]]},{"id":"19454010.11a81","type":"mongodb out","z":"6a72c641.6eadf8","mongodb":"99b811f7.2a08b","name":"salvar","collection":"indice","payonly":true,"upsert":false,"multi":true,"operation":"store","x":1593.7771759033203,"y":313.3850202560425,"wires":[]},{"id":"4deeb71c.ace508","type":"function","z":"6a72c641.6eadf8","name":"collection inicial indice","func":"msg.payload = {\n\t\"_id\": \"indice\",\n\t\"indice_mesagens\": 0\n}\nvar x = msg.payload.indice_mesagens;\nnode.status({fill:\"blue\",shape:\"dot\",text:'Indice =' + x});\nreturn msg;","outputs":1,"noerr":0,"x":1259.9806823730469,"y":313.9618835449219,"wires":[["19454010.11a81"]]},{"id":"99b811f7.2a08b","type":"mongodb","z":"6a72c641.6eadf8","hostname":"127.0.0.1","port":"27017","db":"db","name":""},{"id":"ea40591b.5f6778","type":"mongodb","z":"","hostname":"127.0.0.1","port":"27017","db":"db","name":""}]
